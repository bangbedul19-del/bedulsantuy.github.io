<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Address Bar Update Before Alert Test</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #0f172a;
    color: #e5e7eb;
    padding: 40px;
  }
  button {
    padding: 14px 22px;
    font-size: 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #2563eb;
    color: white;
  }
  pre {
    margin-top: 20px;
    background: #020617;
    padding: 15px;
    border-radius: 8px;
    font-size: 13px;
    border: 1px solid #1e293b;
  }
</style>
</head>

<body>

<h1>Navigation Race Condition Test</h1>
<p>
This test attempts to trigger an alert
<strong>after navigation has started</strong>
and the address bar has updated.
</p>

<button onclick="runTest()">Run Test</button>

<pre id="log"></pre>

<script>
function log(msg) {
  document.getElementById("log").textContent += msg + "\n";
}

function runTest() {
  const start = performance.now();
  log("[+] Clicked at " + start.toFixed(2) + " ms");

  // Schedule alert slightly delayed
  setTimeout(() => {
    const t = performance.now();
    log("[!] Alert executed at " + t.toFixed(2) + " ms");
    alert(
      "Delayed alert executed.\n\n" +
      "JS origin: " + location.origin
    );
  }, 30); // ⚠️ ubah 10–50 ms untuk eksperimen

  // Trigger navigation immediately
  const nav = performance.now();
  log("[+] Navigation triggered at " + nav.toFixed(2) + " ms");
  location.href = "https://www.google.com";
}
</script>

</body>
</html>